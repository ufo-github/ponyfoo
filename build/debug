#!/bin/bash

: ${PORT:="3000"}

# cleanup
npm run clean
mkdir -p .bin/public/{js,css}

# compile
stylus client/css/all.styl -o .bin/public/css --include client/css --watch &
jade views/**/* --out .bin --client --commonjs --pretty --no-debug --watch &
watchify client/js/main.js -o .bin/public/js/all.js -d -v &

# start nodemon, wait for app.listen, run browser-sync
nodemon app --watch .bin/views/**/* &
procfinder --wait --port $PORT
browser-sync start --files ".bin/**/*" --proxy localhost:$PORT --no-open
