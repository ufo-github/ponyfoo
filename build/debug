#!/bin/bash

: ${PORT:="3000"}

# cleanup
rm -rf .bin && mkdir -p .bin/public/{js,css}

# compile
stylus client/css/all.styl -o .bin/public/css --include client/css --watch &
jade views --out .bin --client --commonjs --no-debug --watch &
watchify client/js/main.js -o .bin/public/js/all.js -d -v &

# start nodemon, wait for app.listen, run browser-sync
nodemon app &
procfinder --wait --port $PORT
browser-sync start --files ".bin/public/**/*" --proxy localhost:$PORT --no-open
